# Data Model: Next.js 15 and 16 Pattern Examples

**Feature**: 001-nextjs-patterns-demo  
**Phase**: 1 (Design & Contracts)  
**Created**: 2025-12-19

## Purpose

Define the structure of entities representing pattern examples, categories, and navigationâ€”all hardcoded in source code (no database persistence).

---

## Category Taxonomy (Canonical)

All pattern examples MUST be assigned to one of these 5 canonical categories:

| Category ID             | Display Name            | Description                                                     | Scope                                                                              |
| ----------------------- | ----------------------- | --------------------------------------------------------------- | ---------------------------------------------------------------------------------- |
| `data-fetching-caching` | Data Fetching & Caching | Patterns for fetching data, caching behavior, revalidation APIs | Async Request APIs, caching defaults, revalidateTag/updateTag/refresh, "use cache" |
| `routing-navigation`    | Routing & Navigation    | Patterns for routing, navigation, middleware, forms             | proxy.ts, enhanced routing, Form component, layout deduplication                   |
| `build-performance`     | Build & Performance     | Build tooling, bundlers, performance optimizations              | Turbopack dev/builds, file system caching, HMR improvements                        |
| `server-components`     | Server Components       | Server/Client component patterns, rendering strategies          | React 19 support, hydration errors, Cache Components                               |
| `developer-experience`  | Developer Experience    | DX improvements, error messages, debugging tools                | Improved stack traces, error overlay, static route indicator                       |

**Mapping Rules**:

- Breaking changes can span multiple categories (tag primary category + note secondary)
- Migration-focused patterns use category of the feature being migrated
- Multi-category patterns (e.g., Cache Components affects both caching + server components) use primary impact category

---

## Entity: PatternExample

Represents a single demonstrable Next.js pattern change between versions.

### Fields

| Field                     | Type       | Required | Description                               | Validation Rules                                         |
| ------------------------- | ---------- | -------- | ----------------------------------------- | -------------------------------------------------------- |
| `id`                      | string     | Yes      | Unique identifier                         | Kebab-case, e.g., `"async-request-apis"`                 |
| `title`                   | string     | Yes      | Display title                             | Max 60 chars; concise and descriptive                    |
| `version`                 | `15 \| 16` | Yes      | Next.js version                           | Enum: 15 or 16                                           |
| `category`                | string     | Yes      | Category reference                        | Must match canonical category ID (see Category Taxonomy) |
| `isBreakingChange`        | boolean    | Yes      | Breaking change flag (FR-004.1)           | true if requires code changes; false otherwise           |
| `migrationImpact`         | string     | Yes      | Migration complexity (FR-004.2)           | Enum: "HIGH", "MEDIUM", "LOW"                            |
| `blogPostLink`            | string     | Yes      | Official blog post URL (FR-004.3)         | Full URL to nextjs.org/blog section                      |
| `beforeAfterSummary`      | string     | Yes      | One-sentence comparison (FR-004.4)        | Max 120 chars; "Before: X. After: Y." format             |
| `description`             | string     | Yes      | Explanation of change (FR-004.5)          | 200-400 chars; plain text                                |
| `whyItMatters`            | string     | Yes      | Rationale for change (FR-004.6)           | 300-500 chars; plain text                                |
| `codeSnippetBefore`       | string     | No       | Code example (old pattern)                | Valid TypeScript/JSX; max 50 lines                       |
| `codeSnippetAfter`        | string     | Yes      | Code example (new pattern)                | Valid TypeScript/JSX; max 50 lines                       |
| `highlightedHTMLBefore`   | string     | No       | Pre-rendered highlighted HTML             | Generated by Shiki at build time                         |
| `highlightedHTMLAfter`    | string     | Yes      | Pre-rendered highlighted HTML             | Generated by Shiki at build time                         |
| `keyChanges`              | string[]   | Yes      | Bullet points of specific changes         | 2-5 items; each max 100 chars                            |
| `availableInOtherVersion` | boolean    | Yes      | Cross-version availability flag           | Used for navigation messages (edge case handling)        |
| `relatedExampleId`        | string     | No       | ID of equivalent example in other version | If availableInOtherVersion=true                          |

### Relationships

- **Belongs to one** ExampleCategory
- **May reference one** related PatternExample in alternate version

### State Transitions

Noneâ€”examples are static data; no lifecycle states.

---

## Entity: ExampleCategory

Groups related pattern examples by domain (e.g., Server Components, Data Fetching).

### Fields

| Field         | Type   | Required | Description                | Validation Rules                        |
| ------------- | ------ | -------- | -------------------------- | --------------------------------------- |
| `id`          | string | Yes      | Unique identifier          | Kebab-case, e.g., `"server-components"` |
| `name`        | string | Yes      | Display name               | Max 30 chars; title case                |
| `description` | string | Yes      | Category description       | Max 150 chars; plain text               |
| `icon`        | string | No       | Icon identifier (optional) | Emoji or Tailwind icon class            |
| `order`       | number | Yes      | Display order              | Integer; lower = higher priority        |

### Relationships

- **Has many** PatternExample entities

---

## Entity: NavigationRoute

Represents routes for version-specific example pages.

### Fields

| Field        | Type       | Required | Description                        | Validation Rules                                        |
| ------------ | ---------- | -------- | ---------------------------------- | ------------------------------------------------------- |
| `path`       | string     | Yes      | URL path                           | Next.js App Router format, e.g., `/examples/[category]` |
| `version`    | `15 \| 16` | Yes      | Target Next.js version             | Enum: 15 or 16                                          |
| `exampleIds` | string[]   | Yes      | List of example IDs for this route | Min 1; max 20; references PatternExample.id             |

### Relationships

- **References many** PatternExample entities via exampleIds

---

## Example Instance (Hardcoded Data)

### PatternExample: Async Request APIs (Next.js 15)

```typescript
{
  id: "async-request-apis",
  title: "Async Request APIs",
  version: 15,
  category: "server-components",
  description: "headers(), cookies(), and other Request APIs are now async functions that must be awaited.",
  whyItMatters: "Breaking change from Next.js 14; ensures proper request context handling in async Server Components.",
  codeSnippetBefore: `// Next.js 14\nimport { cookies } from 'next/headers';\n\nexport default function Page() {\n  const cookieStore = cookies();\n  const theme = cookieStore.get('theme');\n  return <div>Theme: {theme?.value}</div>;\n}`,
  codeSnippetAfter: `// Next.js 15\nimport { cookies } from 'next/headers';\n\nexport default async function Page() {\n  const cookieStore = await cookies();\n  const theme = cookieStore.get('theme');\n  return <div>Theme: {theme?.value}</div>;\n}`,
  highlightedHTMLBefore: "<!-- Generated by Shiki -->",
  highlightedHTMLAfter: "<!-- Generated by Shiki -->",
  keyChanges: [
    "headers() and cookies() are now async functions",
    "Page components must be async to await these APIs",
    "Affects all Server Components using request context"
  ],
  availableInOtherVersion: false,
  relatedExampleId: null
}
```

### ExampleCategory: Server Components

```typescript
{
  id: "server-components",
  name: "Server Components",
  description: "Patterns for React Server Components and async rendering in Next.js",
  icon: "ðŸ–¥ï¸",
  order: 1
}
```

---

## Data Storage Strategy

**Location**: `shared/lib/exampleData.ts`

**Format**:

```typescript
export const categories: ExampleCategory[] = [
  /* ... */
];
export const examples: PatternExample[] = [
  /* ... */
];

export function getExamplesByVersion(version: 15 | 16): PatternExample[] {
  return examples.filter((ex) => ex.version === version);
}

export function getExamplesByCategory(categoryId: string): PatternExample[] {
  return examples.filter((ex) => ex.category === categoryId);
}
```

**Rationale**:

- Version control: Changes tracked via Git
- Type safety: TypeScript interfaces enforce schema
- Build-time validation: Compile errors catch schema violations
- Maintainability: Single source of truth; easy to audit and update
- Performance: No runtime queries; data bundled at build time

---

## Validation Rules Summary

1. **Uniqueness**: `PatternExample.id` and `ExampleCategory.id` must be unique across all entries
2. **Referential Integrity**: `PatternExample.category` must reference valid `ExampleCategory.id`
3. **Cross-version Links**: If `availableInOtherVersion=true`, `relatedExampleId` must reference a PatternExample in the alternate version
4. **Code Quality**: Code snippets must be syntactically valid TypeScript/JSX (enforced by Shiki build step)
5. **Content Limits**: All text fields respect max character limits to ensure readability on standard viewports

---

## Migration from This Model

Not applicableâ€”examples are hardcoded. Future expansion (e.g., CMS integration) would require:

1. Export current data to JSON
2. Create database schema matching entities above
3. Build migration script to import JSON
4. Update data access layer in `shared/lib/exampleData.ts`
